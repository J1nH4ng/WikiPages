import{_ as b,C as t,c as p,o as h,j as i,aD as e,G as n,a,w as k}from"./chunks/framework.Cvnqwbck.js";const j=JSON.parse('{"title":"服务器初始化","description":"服务器的初始化文档","frontmatter":{"title":"服务器初始化","editLink":true,"description":"服务器的初始化文档","layout":"doc","head":[["meta",{"name":"keywords","content":"Linux"}]],"outline":"deep","prev":{"text":"服务器的创建与配置","link":"posts/3edbef81"},"next":{"text":"业务网络架构","link":"posts/0315077c"}},"headers":[],"relativePath":"posts/7ec143e2.md","filePath":"docs/prepare/init.md","lastUpdated":1747387977000}'),g={name:"posts/7ec143e2.md"},m={class:"task-list"},y={class:"task-list-item"},u={for:"cbx_0"},E={class:"task-list-item"},A={for:"cbx_1"},v={class:"task-list-item"},Q={for:"cbx_3"},T={class:"task-list-item"},D={for:"cbx_4"},C={class:"task-list-item"},F={class:"task-list"},f={class:"task-list-item"},x={for:"cbx_12"},H={class:"task-list-item"},w={class:"task-list"},V={class:"task-list-item"},L={for:"cbx_17"},B={class:"task-list-item"},S={for:"cbx_31"},M={id:"安装常用软件",tabindex:"-1"},P={id:"判断磁盘类型",tabindex:"-1"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},I={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"12.886ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 5695.4 727","aria-hidden":"true"},Z={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"47.763ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 21111.2 2400","aria-hidden":"true"},N={class:"timeline-dot"},G={href:"https://www.nvidia.cn/drivers/lookup/",target:"_blank",rel:"noreferrer"};function R(z,s,U,_,Y,$){const l=t("Badge"),r=t("Icon"),d=t("sapn"),o=t("NolebaseGitContributors"),c=t("NolebaseGitChangelog");return h(),p("div",null,[s[59]||(s[59]=i("h1",{id:"服务器初始化",tabindex:"-1"},[a("服务器初始化 "),i("a",{class:"header-anchor",href:"#服务器初始化","aria-label":'Permalink to "服务器初始化"'},"​")],-1)),s[60]||(s[60]=i("p",null,"当操作系统安装完成后，需要对服务器进行初始化操作，以适应生产业务的需要，主要需要的操作内容如下：",-1)),s[61]||(s[61]=i("ul",null,[i("li",null,"软件安装"),i("li",null,"安全加固"),i("li",null,"性能调优"),i("li",null,"其他部分")],-1)),s[62]||(s[62]=i("p",null,"所有需要配置的清单列表如下：",-1)),i("ul",m,[i("li",y,[s[1]||(s[1]=i("input",{type:"checkbox",id:"cbx_0",checked:"true",disabled:"true"},null,-1)),i("label",u,[s[0]||(s[0]=a(" 服务器固定 IP 检查 ")),n(l,{type:"danger",text:"特别注意"})])]),i("li",E,[s[3]||(s[3]=i("input",{type:"checkbox",id:"cbx_1",checked:"true",disabled:"true"},null,-1)),i("label",A,[s[2]||(s[2]=a(" 服务器架构检查 ")),n(l,{type:"warning",text:"需要留意"})]),s[4]||(s[4]=i("ul",{class:"task-list"},[i("li",{class:"task-list-item"},[i("input",{type:"checkbox",id:"cbx_2",checked:"true",disabled:"true"}),i("label",{for:"cbx_2"}," ARM 64 或 AMD 64")])],-1))]),i("li",v,[s[6]||(s[6]=i("input",{type:"checkbox",id:"cbx_3",checked:"true",disabled:"true"},null,-1)),i("label",Q,[s[5]||(s[5]=a(" 各服务器之间的横向 SSH 是否联通 ")),n(l,{type:"danger",text:"后续影响"})])]),i("li",T,[s[8]||(s[8]=i("input",{type:"checkbox",id:"cbx_4",checked:"true",disabled:"true"},null,-1)),i("label",D,[s[7]||(s[7]=a(" 服务器密码强弱性检查 ")),n(l,{type:"danger",text:"特别注意"})]),s[9]||(s[9]=i("ul",{class:"task-list"},[i("li",{class:"task-list-item"},[i("input",{type:"checkbox",id:"cbx_5",checked:"true",disabled:"true"}),i("label",{for:"cbx_5"}," 弱密码")])],-1))]),s[26]||(s[26]=e('<li class="task-list-item"><input type="checkbox" id="cbx_6" checked="true" disabled="true"><label for="cbx_6"> 修改镜像源</label></li><li class="task-list-item"><input type="checkbox" id="cbx_7" checked="true" disabled="true"><label for="cbx_7"> 配置 History 格式</label></li><li class="task-list-item"><input type="checkbox" id="cbx_8" checked="true" disabled="true"><label for="cbx_8"> 安装依赖</label></li><li class="task-list-item"><input type="checkbox" id="cbx_9" checked="true" disabled="true"><label for="cbx_9"> 时钟同步</label></li>',4)),i("li",C,[s[14]||(s[14]=i("input",{type:"checkbox",id:"cbx_10",checked:"true",disabled:"true"},null,-1)),s[15]||(s[15]=i("label",{for:"cbx_10"}," 数据磁盘部分",-1)),i("ul",F,[s[12]||(s[12]=i("li",{class:"task-list-item"},[i("input",{type:"checkbox",id:"cbx_11",checked:"true",disabled:"true"}),i("label",{for:"cbx_11"}," 虚拟机是否挂载数据盘")],-1)),i("li",f,[s[11]||(s[11]=i("input",{type:"checkbox",id:"cbx_12",checked:"true",disabled:"true"},null,-1)),i("label",x,[s[10]||(s[10]=a(" 测试磁盘是否为 SSD ")),n(l,{type:"danger",text:"后续影响"})])]),s[13]||(s[13]=i("li",{class:"task-list-item"},[i("input",{type:"checkbox",id:"cbx_13",checked:"true",disabled:"true"}),i("label",{for:"cbx_13"}," 配置 LVM")],-1))])]),s[27]||(s[27]=i("li",{class:"task-list-item"},[i("input",{type:"checkbox",id:"cbx_14",checked:"true",disabled:"true"}),i("label",{for:"cbx_14"}," 升级 OpenSSL")],-1)),i("li",H,[s[22]||(s[22]=i("input",{type:"checkbox",id:"cbx_15",checked:"true",disabled:"true"},null,-1)),s[23]||(s[23]=i("label",{for:"cbx_15"}," 升级 OpenSSH",-1)),i("ul",w,[s[21]||(s[21]=i("li",{class:"task-list-item"},[i("input",{type:"checkbox",id:"cbx_16",checked:"true",disabled:"true"}),i("label",{for:"cbx_16"}," 9.8p1 版本以上")],-1)),i("li",V,[s[20]||(s[20]=i("input",{type:"checkbox",id:"cbx_17",checked:"true",disabled:"true"},null,-1)),i("label",L,[s[16]||(s[16]=a(" 禁用特定算法，修复 ")),n(r,{icon:"streamline:bug-antivirus-debugging-solid",style:{color:"#76b900"}}),s[17]||(s[17]=a()),s[18]||(s[18]=i("a",{href:"./a7fc9217.html"},"CVE-2002-20001",-1)),s[19]||(s[19]=a(" 漏洞"))])])])]),s[28]||(s[28]=e('<li class="task-list-item"><input type="checkbox" id="cbx_18" disabled="true"><label for="cbx_18"> 配置 SSH 安全</label><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_19" checked="true" disabled="true"><label for="cbx_19"> 修改 SSH 连接协议</label></li><li class="task-list-item"><input type="checkbox" id="cbx_20" checked="true" disabled="true"><label for="cbx_20"> 修改默认的 22 端口</label></li><li class="task-list-item"><input type="checkbox" id="cbx_21" checked="true" disabled="true"><label for="cbx_21"> 结束空闲会话</label></li><li class="task-list-item"><input type="checkbox" id="cbx_22" checked="true" disabled="true"><label for="cbx_22"> 显示最后一次登录</label></li><li class="task-list-item"><input type="checkbox" id="cbx_23" checked="true" disabled="true"><label for="cbx_23"> 禁止 root 用户远程登录</label></li><li class="task-list-item"><input type="checkbox" id="cbx_24" checked="true" disabled="true"><label for="cbx_24"> 禁止 su 命令切换至 root 用户</label></li><li class="task-list-item"><input type="checkbox" id="cbx_25" disabled="true"><label for="cbx_25"> 配置 Fail2ban</label></li></ul></li><li class="task-list-item"><input type="checkbox" id="cbx_26" checked="true" disabled="true"><label for="cbx_26"> 防火墙开放状态</label></li><li class="task-list-item"><input type="checkbox" id="cbx_27" checked="true" disabled="true"><label for="cbx_27"> SELinux 配置</label></li><li class="task-list-item"><input type="checkbox" id="cbx_28" disabled="true"><label for="cbx_28"> 性能优化</label><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_29" disabled="true"><label for="cbx_29"> 配置文件最大打开数</label></li><li class="task-list-item"><input type="checkbox" id="cbx_30" disabled="true"><label for="cbx_30"> 调整内核参数</label></li></ul></li>',4)),i("li",B,[s[25]||(s[25]=i("input",{type:"checkbox",id:"cbx_31",checked:"true",disabled:"true"},null,-1)),i("label",S,[s[24]||(s[24]=a(" 安装显卡驱动 ")),n(l,{type:"tip",text:"特定服务器"})])])]),s[63]||(s[63]=e(`<h2 id="前置检查" tabindex="-1">前置检查 <a class="header-anchor" href="#前置检查" aria-label="Permalink to &quot;前置检查&quot;">​</a></h2><h3 id="固定-ip-检查" tabindex="-1">固定 IP 检查 <a class="header-anchor" href="#固定-ip-检查" aria-label="Permalink to &quot;固定 IP 检查&quot;">​</a></h3><p>对于服务器而已，IP 地址最好是固化在服务器上的，而不是使用路由器进行 DHCP 服务，使用 DHCP 的情况下，一旦服务器因为业务故障停机在重启后可能会导致 IP 地址的变化，从而影响至少两台服务器的正常运行。修改如下的配置文件，配置为固定 IP：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/sysconfig/network-scripts/ifcfg-ens3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block github-alert"><p class="custom-block-title">注意：</p><p>这里的 <code>ifcfg-ens3</code> 中的 ens3 为需要修改的网卡，请修改成自己的网络网卡。</p><p>如果有多个网卡，请注意本机的多个网卡中的 IP 地址。</p></div><p>修改配置文件中的如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">TYPE=Ethernet</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">PROXY_METHOD=none</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">BROWSER_ONLY=no</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">BOOTPROTO=dhcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">BOOTPROTO=static</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPADDR=&quot;192.168.50.100&quot;</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">NETMASK=&quot;255.255.255.0&quot;</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">GATEWAY=&quot;192.168.50.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">DEFROUTE=yes</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV4_FAILURE_FATAL=no</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6INIT=yes</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6INIT=no</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6_AUTOCONF=yes</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6_AUTOCONF=no</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6_DEFROUTE=yes</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6_DEFROUTE=no</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6_FAILURE_FATAL=no</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">IPV6_ADDR_GEN_MODE=stable-privacy</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">NAME=ens3</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">UUID=fa933398-af5a-41e4-bc66-8812ba78cd18</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">DEVICE=ens3</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">ONBOOT=yes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>在上述的配置中将 IPv4 地址修改为固定的 IP 地址，同时禁用了 IPv6 的使用。</p><p>修改完成后，需要重启网络服务，如果可以的话，<strong>重启服务器进行验证</strong>。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>重启完成后进行 IP 地址的查看，如果与设定的一致则代表成功。如果暂时不能重启服务器，可以进行网卡的重启：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> NetworkManager</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="服务器架构检查" tabindex="-1">服务器架构检查 <a class="header-anchor" href="#服务器架构检查" aria-label="Permalink to &quot;服务器架构检查&quot;">​</a></h3><p>检查服务器的系统架构，确保在安装业务所需软件时下载正确的架构版本安装包，使用如下命令进行查看：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">uname</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -m</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>常见的为 64 位版本，输出结果一般为：<code>x86_64</code>，对于不同的输出，可以自行上网查看为何种架构，并在后续安装软件时下载对应的架构版本安装包即可，为了文档编写的方便，这里默认所有的服务器系统架构都为 64 位版本。</p><h3 id="横向-ssh-通信检查" tabindex="-1">横向 SSH 通信检查 <a class="header-anchor" href="#横向-ssh-通信检查" aria-label="Permalink to &quot;横向 SSH 通信检查&quot;">​</a></h3>`,17)),i("p",null,[s[29]||(s[29]=a("主要检查的是 Jenkins 或其他 CI&CD 软件所在的服务器能否通过 SSH 协议访问至应用服务器，主要影响在于后续配置流水线发布时需要通过 SSH 协议进行代码包分发，如果无法通信，后续流水线可能无法搭建。")),n(l,{type:"warning",text:"寻找他法"})]),s[64]||(s[64]=e(`<p>检查方法很简单，在 Jenkins 所在服务器上使用 SSH 协议登录其他服务器，如果可以成功登录即证明通信正常，注意为了安全，可以端口号不是默认的 22 端口：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 192.168.50.11 为应用服务器中的其中一台的局域网 IP 地址</span></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 22022 是为了安全而修改后的 SSH 协议占用的端口，如果不显式指定，则为默认的 22 端口</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ssh</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nginx@192.168.50.11</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -p</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 22022</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果成功，会要求输入密码进行验证登录，如果返回其他结果，请视具体情况而定。</p><p>这里以一台为例，对于其他的应用服务器，只需要修改相应的 IP 地址即可，这里不在做演示。</p><h3 id="服务器密码强弱性检查" tabindex="-1">服务器密码强弱性检查 <a class="header-anchor" href="#服务器密码强弱性检查" aria-label="Permalink to &quot;服务器密码强弱性检查&quot;">​</a></h3><p>服务器的密码不能是常见的弱密码，最好为 16 位以上包含如下内容的乱序字符串：</p><ul><li>大小写字母</li><li>数字</li><li>特殊标点</li></ul><p>特别注意，不要使用容易混肴的字母和数字，例如：</p><ul><li>0、o、O</li><li>I、l、1</li><li>2、Z、z</li></ul><p>如果密码不符合要求，可以使用如下命令来修改特定用户的密码。</p><div class="important custom-block github-alert"><p class="custom-block-title">特别注意：</p><p>注意使用 root 用户进行该操作</p></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 修改 nginx 用户密码</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">passwd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 修改 root 用户密码</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">passwd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="软件安装配置" tabindex="-1">软件安装配置 <a class="header-anchor" href="#软件安装配置" aria-label="Permalink to &quot;软件安装配置&quot;">​</a></h2><p>软件安装的主要是为了方便后续的运维操作，以及确保编译安装业务软件所需求的依赖存在等。</p><p>软件配置主要为配置终端和 vim 的 rc 文件，确保后续不会因为复制粘贴等问题影响缩进从而导致的错误，尤其是针对 yaml 这种强依赖缩进的文件格式。</p><h3 id="修改镜像源" tabindex="-1">修改镜像源 <a class="header-anchor" href="#修改镜像源" aria-label="Permalink to &quot;修改镜像源&quot;">​</a></h3><p>对于 OpenEuler 和 OpenKylin 系统来说，镜像源默认为国内源地址，不需要进行修改，对于旧的 CentOS 系统来说，镜像源已经不在维护，无需修改。</p><h3 id="修改-history-格式" tabindex="-1">修改 History 格式 <a class="header-anchor" href="#修改-history-格式" aria-label="Permalink to &quot;修改 History 格式&quot;">​</a></h3><p>在历史命令中增加时间戳，在某些时候，定位一些历史问题、或者一些操作，都是有很不错地帮助意义的，其中的配置如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/profile</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>写入如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">export</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;"> HISTTIMEFORMAT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">\`</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">whoami</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">\`</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> : %F %Y :&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>配置完成后，使用 source 命令加载：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">source</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/profile</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,24)),i("h3",M,[s[30]||(s[30]=a("安装常用软件 ")),n(l,{type:"tip",text:"持续更新"}),s[31]||(s[31]=a()),s[32]||(s[32]=i("a",{class:"header-anchor",href:"#安装常用软件","aria-label":'Permalink to "安装常用软件  <Badge type="tip" text="持续更新" />"'},"​",-1))]),s[65]||(s[65]=e(`<p>对于常用地依赖软件，使用 <code>yum</code> 来进行安装，主要安装的内容如下：</p><ol><li>更新现存的文件依赖<div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> update</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>安装常用地运维软件<div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> gcc</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> gcc-c++</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> make</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    net-tools</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> kernel-devel</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    telnet</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> ntpdate</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> wget</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lrzsz</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    htop</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lsof</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> iotop</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> hdparm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li>安装开发工具<div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> groupinstall</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &#39;Development tools&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h2 id="时钟同步检查" tabindex="-1">时钟同步检查 <a class="header-anchor" href="#时钟同步检查" aria-label="Permalink to &quot;时钟同步检查&quot;">​</a></h2><div class="danger custom-block github-alert"><p class="custom-block-title">特别事项：</p><p>后续需要修改文章内容，为了安全性考虑，应该有一台时钟服务器进行时钟同步，其他服务器同步该服务器且不能访问外部网络。 该部分会在后续 NTP 服务器搭建完成后进行修改，也可以不进行修改，转而对服务器进行出网访问限制。</p></div><p>时钟同步配置主要目的在于确保服务器的时间的一致性，对于时延性有较高要求的业务有较大影响，比如：支付接口。</p><p>当前服务器的时钟状态可以使用 <code>timedatectl</code> 进行查看，执行结果如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">               Local</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> time:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 三</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 2025-02-26</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 15:20:15</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> CST</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">           Universal</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> time:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 三</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 2025-02-26</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 07:20:15</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> UTC</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">                 RTC</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> time:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 三</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 2025-02-26</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 07:17:47</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">                Time</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> zone:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Asia/Shanghai</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"> (CST, </span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">+0800</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">)</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">System</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> clock</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> synchronized:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> yes</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">              NTP</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> service:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> active</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">          RTC</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> in</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> local</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> TZ:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>国内时区为东八区，具体表现为上述结果的 Time zone 字段为 <code>Asia/Shanghai</code>，如果不是，可以使用如下命令进行修改：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">timedatectl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> set-timezone</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Asia/Shanghai</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>修改完成后，重新执行 <code>timedatectl</code> 查看输出结果。</p><p>如果时间不对，执行如下命令进行同步：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ntpdate</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> ntp.aliyun.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>时间同步成功后将同步后的时间写入至硬件时钟上：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">clock</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -w</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>随着运行时间的增加，软件和硬件时钟也会逐步落后于标准时间，为了确保业务的可用性，还需要配置定时任务进行同步，使用如下命令创建定时任务。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">crontab</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -e</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>写入配置文件，每半小时同步一次时钟：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff add"><span># 时钟同步</span></span>
<span class="line diff add"><span>*/30 * * * * /usr/sbin/ntpdate ntp.aliyun.com &amp;&amp; /usr/sbin/clock -w</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="数据磁盘检查" tabindex="-1">数据磁盘检查 <a class="header-anchor" href="#数据磁盘检查" aria-label="Permalink to &quot;数据磁盘检查&quot;">​</a></h2><h3 id="查看磁盘挂载" tabindex="-1">查看磁盘挂载 <a class="header-anchor" href="#查看磁盘挂载" aria-label="Permalink to &quot;查看磁盘挂载&quot;">​</a></h3><p>尤其是对于虚拟机来说，新建服务器时会手动指定挂载数据磁盘，可以通过 <code>lsblk</code> 命令进行查看，会输出类似于如下结果：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vda</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    253:0</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   40G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disk</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"> </span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">├─vda1</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 253:1</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    4G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> part</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"> [SWAP]</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">└─vda2</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 253:2</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   36G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> part</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vdb</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    253:16</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">   0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  100G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如上所示，vdb 为挂载的数据盘，但是并没有初始化，所以没有任何分区显示。</p>`,23)),i("h3",P,[s[33]||(s[33]=a("判断磁盘类型 ")),n(l,{type:"danger",text:"后续影响"}),s[34]||(s[34]=a()),s[35]||(s[35]=i("a",{class:"header-anchor",href:"#判断磁盘类型","aria-label":'Permalink to "判断磁盘类型 <Badge type="danger" text="后续影响" />"'},"​",-1))]),s[66]||(s[66]=e(`<p>需要的磁盘类型主要根据该服务器在生产环境中的具体作用而定，对于数据库服务器，缓存服务器，热日志读写服务器等，磁盘最好为 SSD，而对于冷数据读取，可以使用 HDD 磁盘。</p><div class="tip custom-block github-alert"><p class="custom-block-title">注意事项：</p><p>在虚拟机内，请根据磁盘的读写速度来判断磁盘类型，而不是系统输出的标识来判定。</p></div><p>使用如下命令来进行读写速度测试：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">hdparm</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -Tt</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">\${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">disk-name</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行结果如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">[</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">root@ECHO-SERVER </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">~</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">]</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"># hdparm -Tt /dev/nvme0n1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">/dev/nvme0n1:</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> Timing</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> cached</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> reads:</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">   40446</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> MB</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> in</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  1.98</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> seconds</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> =</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 20439.89</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> MB/sec</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> Timing</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> buffered</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disk</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> reads:</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 5384</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> MB</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> in</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  3.00</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> seconds</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> =</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 1794.45</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> MB/sec</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,6)),i("p",null,[s[38]||(s[38]=a("可以查看到磁盘读取速度在每秒 1800 MB 左右，理论上 ")),i("mjx-container",q,[(h(),p("svg",I,s[36]||(s[36]=[e('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="50" d="M130 622Q123 629 119 631T103 634T60 637H27V683H214Q237 683 276 683T331 684Q419 684 471 671T567 616Q624 563 624 489Q624 421 573 372T451 307Q429 302 328 301H234V181Q234 62 237 58Q245 47 304 46H337V0H326Q305 3 182 3Q47 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM507 488Q507 514 506 528T500 564T483 597T450 620T397 635Q385 637 307 637H286Q237 637 234 628Q231 624 231 483V342H302H339Q390 342 423 349T481 382Q507 411 507 488Z" style="stroke-width:3;"></path><path data-c="43" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q322 658 252 588Q173 509 173 342Q173 221 211 151Q232 111 263 84T328 45T384 29T428 24Q517 24 571 93T626 244Q626 251 632 257H660L666 251V236Q661 133 590 56T403 -21Q262 -21 159 83T56 342Z" transform="translate(681,0)" style="stroke-width:3;"></path><path data-c="49" d="M328 0Q307 3 180 3T32 0H21V46H43Q92 46 106 49T126 60Q128 63 128 342Q128 620 126 623Q122 628 118 630T96 635T43 637H21V683H32Q53 680 180 680T328 683H339V637H317Q268 637 254 634T234 623Q232 620 232 342Q232 63 234 60Q238 55 242 53T264 48T317 46H339V0H328Z" transform="translate(1403,0)" style="stroke-width:3;"></path><path data-c="45" d="M128 619Q121 626 117 628T101 631T58 634H25V680H597V676Q599 670 611 560T625 444V440H585V444Q584 447 582 465Q578 500 570 526T553 571T528 601T498 619T457 629T411 633T353 634Q266 634 251 633T233 622Q233 622 233 621Q232 619 232 497V376H286Q359 378 377 385Q413 401 416 469Q416 471 416 473V493H456V213H416V233Q415 268 408 288T383 317T349 328T297 330Q290 330 286 330H232V196V114Q232 57 237 52Q243 47 289 47H340H391Q428 47 452 50T505 62T552 92T584 146Q594 172 599 200T607 247T612 270V273H652V270Q651 267 632 137T610 3V0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(1764,0)" style="stroke-width:3;"></path><path data-c="20" d="" transform="translate(2445,0)" style="stroke-width:3;"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(2695,0)" style="stroke-width:3;"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(3195,0)" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(3473,0)" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(4195.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(5195.4,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" style="stroke-width:3;"></path></g></g></g>',1)]))),s[37]||(s[37]=i("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mtext",null,"PCIE 4.0"),i("mo",null,"×"),i("mn",null,"4")])],-1))]),s[39]||(s[39]=a(" 的 SSD 读取速度在 7000 MB/sec，同时根据磁盘命名也可以推测出来，nvme 开头的一般都为 SSD。"))]),s[67]||(s[67]=i("h3",{id:"新增与拓展-lvm-磁盘",tabindex:"-1"},[a("新增与拓展 LVM 磁盘 "),i("a",{class:"header-anchor",href:"#新增与拓展-lvm-磁盘","aria-label":'Permalink to "新增与拓展 LVM 磁盘"'},"​")],-1)),s[68]||(s[68]=i("p",null,"LVM（Login Volume Manger），是 Linux 内核提供的一种逻辑卷管理功能，有内核驱动和应用层工具组成，它是在硬盘的分区基础上，创建了一个逻辑层，可以非常灵活且方便的管理存储设备。",-1)),s[69]||(s[69]=i("p",null,"LVM 利用 Linux 内核的 device-manager 功能来实现存储系统的虚拟化（系统分区独立于底层硬件）。通过 LVM，可以实现存储空间的抽象化并在上面建立虚拟分区（virtual partitions），可以更简便地扩大和缩小分区，可以增删分区时无需担心某个硬盘上没有足够的连续空间，避免为正在使用的磁盘重新分区的麻烦、为调整分区分区而不得不移动其他分区的不便，相比于传统的分区系统可以更灵活地管理磁盘。",-1)),s[70]||(s[70]=i("p",null,"创建一个 LVM 磁盘的基本逻辑如下：",-1)),i("mjx-container",Z,[(h(),p("svg",O,s[40]||(s[40]=[e('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z" style="stroke-width:3;"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mtext"><path data-c="44" d="M130 622Q123 629 119 631T103 634T60 637H27V683H228Q399 682 419 682T461 676Q504 667 546 641T626 573T685 470T708 336Q708 210 634 116T442 3Q429 1 228 0H27V46H60Q102 47 111 49T130 61V622ZM593 338Q593 439 571 501T493 602Q439 637 355 637H322H294Q238 637 234 628Q231 624 231 344Q231 62 232 59Q233 49 248 48T339 46H350Q456 46 515 95Q561 133 577 191T593 338Z" style="stroke-width:3;"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(764,0)" style="stroke-width:3;"></path><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z" transform="translate(1042,0)" style="stroke-width:3;"></path><path data-c="6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z" transform="translate(1436,0)" style="stroke-width:3;"></path><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z" transform="translate(1964,0)" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mtext"><path data-c="50" d="M130 622Q123 629 119 631T103 634T60 637H27V683H214Q237 683 276 683T331 684Q419 684 471 671T567 616Q624 563 624 489Q624 421 573 372T451 307Q429 302 328 301H234V181Q234 62 237 58Q245 47 304 46H337V0H326Q305 3 182 3Q47 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM507 488Q507 514 506 528T500 564T483 597T450 620T397 635Q385 637 307 637H286Q237 637 234 628Q231 624 231 483V342H302H339Q390 342 423 349T481 382Q507 411 507 488Z" style="stroke-width:3;"></path><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(681,0)" style="stroke-width:3;"></path><path data-c="72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z" transform="translate(1181,0)" style="stroke-width:3;"></path><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(1573,0)" style="stroke-width:3;"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(1962,0)" style="stroke-width:3;"></path><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(2240,0)" style="stroke-width:3;"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(2629,0)" style="stroke-width:3;"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(2907,0)" style="stroke-width:3;"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(3407,0)" style="stroke-width:3;"></path><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z" transform="translate(3963,0)" style="stroke-width:3;"></path></g></g></g></g><g data-mml-node="mo" transform="translate(5107,0) translate(0 250)"></g></g><g data-mml-node="mo" transform="translate(5384.8,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z" style="stroke-width:3;"></path></g><g data-mml-node="mtext" transform="translate(6662.6,0)"><path data-c="50" d="M130 622Q123 629 119 631T103 634T60 637H27V683H214Q237 683 276 683T331 684Q419 684 471 671T567 616Q624 563 624 489Q624 421 573 372T451 307Q429 302 328 301H234V181Q234 62 237 58Q245 47 304 46H337V0H326Q305 3 182 3Q47 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM507 488Q507 514 506 528T500 564T483 597T450 620T397 635Q385 637 307 637H286Q237 637 234 628Q231 624 231 483V342H302H339Q390 342 423 349T481 382Q507 411 507 488Z" style="stroke-width:3;"></path><path data-c="56" d="M114 620Q113 621 110 624T107 627T103 630T98 632T91 634T80 635T67 636T48 637H19V683H28Q46 680 152 680Q273 680 294 683H305V637H284Q223 634 223 620Q223 618 313 372T404 126L490 358Q575 588 575 597Q575 616 554 626T508 637H503V683H512Q527 680 627 680Q718 680 724 683H730V637H723Q648 637 627 596Q627 595 515 291T401 -14Q396 -22 382 -22H374H367Q353 -22 348 -14Q346 -12 231 303Q114 617 114 620Z" transform="translate(681,0)" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(8371.3,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z" style="stroke-width:3;"></path></g><g data-mml-node="mtext" transform="translate(9649.1,0)"><path data-c="56" d="M114 620Q113 621 110 624T107 627T103 630T98 632T91 634T80 635T67 636T48 637H19V683H28Q46 680 152 680Q273 680 294 683H305V637H284Q223 634 223 620Q223 618 313 372T404 126L490 358Q575 588 575 597Q575 616 554 626T508 637H503V683H512Q527 680 627 680Q718 680 724 683H730V637H723Q648 637 627 596Q627 595 515 291T401 -14Q396 -22 382 -22H374H367Q353 -22 348 -14Q346 -12 231 303Q114 617 114 620Z" style="stroke-width:3;"></path><path data-c="47" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q401 658 376 654T316 633T254 592T205 519T177 411Q173 369 173 335Q173 259 192 201T238 111T302 58T370 31T431 24Q478 24 513 45T559 100Q562 110 562 160V212Q561 213 557 216T551 220T542 223T526 225T502 226T463 227H437V273H449L609 270Q715 270 727 273H735V227H721Q674 227 668 215Q666 211 666 108V6Q660 0 657 0Q653 0 639 10Q617 25 600 42L587 54Q571 27 524 3T406 -22Q317 -22 238 22T108 151T56 342Z" transform="translate(750,0)" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(11461.9,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z" style="stroke-width:3;"></path></g><g data-mml-node="mtext" transform="translate(12739.7,0)"><path data-c="4C" d="M128 622Q121 629 117 631T101 634T58 637H25V683H36Q48 680 182 680Q324 680 348 683H360V637H333Q273 637 258 635T233 622L232 342V129Q232 57 237 52Q243 47 313 47Q384 47 410 53Q470 70 498 110T536 221Q536 226 537 238T540 261T542 272T562 273H582V268Q580 265 568 137T554 5V0H25V46H58Q100 47 109 49T128 61V622Z" style="stroke-width:3;"></path><path data-c="56" d="M114 620Q113 621 110 624T107 627T103 630T98 632T91 634T80 635T67 636T48 637H19V683H28Q46 680 152 680Q273 680 294 683H305V637H284Q223 634 223 620Q223 618 313 372T404 126L490 358Q575 588 575 597Q575 616 554 626T508 637H503V683H512Q527 680 627 680Q718 680 724 683H730V637H723Q648 637 627 596Q627 595 515 291T401 -14Q396 -22 382 -22H374H367Q353 -22 348 -14Q346 -12 231 303Q114 617 114 620Z" transform="translate(625,0)" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(14392.4,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z" style="stroke-width:3;"></path></g><g data-mml-node="mtext" transform="translate(15670.2,0)"><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" style="stroke-width:3;"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(653,0)" style="stroke-width:3;"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(931,0)" style="stroke-width:3;"></path><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(1209,0)" style="stroke-width:3;"></path><path data-c="20" d="" transform="translate(1653,0)" style="stroke-width:3;"></path><path data-c="53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z" transform="translate(1903,0)" style="stroke-width:3;"></path><path data-c="79" d="M69 -66Q91 -66 104 -80T118 -116Q118 -134 109 -145T91 -160Q84 -163 97 -166Q104 -168 111 -168Q131 -168 148 -159T175 -138T197 -106T213 -75T225 -43L242 0L170 183Q150 233 125 297Q101 358 96 368T80 381Q79 382 78 382Q66 385 34 385H19V431H26L46 430Q65 430 88 429T122 428Q129 428 142 428T171 429T200 430T224 430L233 431H241V385H232Q183 385 185 366L286 112Q286 113 332 227L376 341V350Q376 365 366 373T348 383T334 385H331V431H337H344Q351 431 361 431T382 430T405 429T422 429Q477 429 503 431H508V385H497Q441 380 422 345Q420 343 378 235T289 9T227 -131Q180 -204 113 -204Q69 -204 44 -177T19 -116Q19 -89 35 -78T69 -66Z" transform="translate(2459,0)" style="stroke-width:3;"></path><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z" transform="translate(2987,0)" style="stroke-width:3;"></path><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(3381,0)" style="stroke-width:3;"></path><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(3770,0)" style="stroke-width:3;"></path><path data-c="6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(4214,0)" style="stroke-width:3;"></path><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z" transform="translate(5047,0)" style="stroke-width:3;"></path></g></g></g>',1)]))),s[41]||(s[41]=i("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[i("mrow",{"data-mjx-texclass":"INNER"},[i("mo",{"data-mjx-texclass":"OPEN"},"{"),i("mtable",{columnalign:"left left",columnspacing:"1em",rowspacing:"4pt"},[i("mtr",null,[i("mtd",null,[i("mtext",null,"Disks")])]),i("mtr",null,[i("mtd",null,[i("mtext",null,"Partitions")])])]),i("mo",{"data-mjx-texclass":"CLOSE",fence:"true",stretchy:"true",symmetric:"true"})]),i("mo",{stretchy:"false"},"⇒"),i("mtext",null,"PV"),i("mo",{stretchy:"false"},"⇒"),i("mtext",null,"VG"),i("mo",{stretchy:"false"},"⇒"),i("mtext",null,"LV"),i("mo",{stretchy:"false"},"⇒"),i("mtext",null,"File Systems")])],-1))]),s[71]||(s[71]=e(`<div class="note custom-block github-alert"><p class="custom-block-title">说明：</p><p></p><p>物理磁盘可以直接添加到 LVM PV 中，而不必是磁盘分区。</p></div><h4 id="新增-lvm-磁盘" tabindex="-1">新增 LVM 磁盘 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> <a class="header-anchor" href="#新增-lvm-磁盘" aria-label="Permalink to &quot;新增 LVM 磁盘 [^1]&quot;">​</a></h4><div class="timeline-dot"><span class="timeline-dot-title"></span><p>查看磁盘</p><p>使用如下命令，查看添加到服务器上的新磁盘或未使用的分组空间：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lsblk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>输出的结果如下所示：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">NAME</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">           MAJ:MIN</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> RM</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   SIZE</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> RO</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> TYPE</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  MOUNTPOINT</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">sda</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">              8:0</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 279.4G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disk</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">  </span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">├─sda1</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">           8:1</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">     1G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> part</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  /boot</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">└─sda2</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">           8:2</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 278.4G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> part</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">  </span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  ├─rh-root</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    253:0</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    50G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lvm</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   /</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  ├─rh-swap</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    253:1</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    28G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lvm</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">   [SWAP]</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  └─rh-home</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    253:4</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 200.4G</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lvm</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   /home</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">sdb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里可以查看 <code>sdb</code> 磁盘未被使用。</p></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>创建 PV</p><div class="warning custom-block github-alert"><p class="custom-block-title">注意：</p><p></p><p>该操作会清空磁盘上的所有数据，请谨慎操作。</p></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">pvcreate</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/sdb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>使用如下命令查看当前存在的 VG：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vgdisplay</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果存在 VG 就根据需要添加磁盘至旧的 VG 中，如果不存在或不需要就创建新的 VG：</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-wmVFa" id="tab-cc7WpUe" checked><label data-title="添加至已存在的 VG" for="tab-cc7WpUe">添加至已存在的 VG</label><input type="radio" name="group-wmVFa" id="tab-SFHfT2t"><label data-title="创建新的 VG" for="tab-SFHfT2t">创建新的 VG</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vgextend</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> old-vg-name</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/sdb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vgcreate</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> new-vg-name</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/sdb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>创建 LV</p><p>创建 LV 的命令如下所示：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lvcreate</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -n</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lv-name</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -l</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> +100%FREE</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> vg-name</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里以 <code>data</code> 为例，在 VG rh 中创建：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lvcreate</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -n</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> data</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -l</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> +100%FREE</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>初始化文件系统</p><p>创建完 LV 之后，还需要初始化文件系统，不然无法正常使用，对于不同的文件系统，分别使用如下的命令进行初始化：</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-gebhX" id="tab-ausNCdn" checked><label data-title="ext4 文件系统" for="tab-ausNCdn">ext4 文件系统</label><input type="radio" name="group-gebhX" id="tab--vKLlGT"><label data-title="xfs 文件系统" for="tab--vKLlGT">xfs 文件系统</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkfs.ext4</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/rh-data</span></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> or</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkfs</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -t</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> ext4</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/rh-data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkfs.xfs</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/rh-data</span></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> or</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkfs</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -t</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> xfs</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/rh-data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>挂载磁盘</p><p>创建完成后，还需要将上述的磁盘挂载至 <code>/data</code> 目录下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkdir</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data</span></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 新生成的 LV 一般位于 /dev/mapper 目录下</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mount</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/rh-data</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>配置 <code>/etc/fstab</code> 文件，实现开机自启：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/fstab</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>写入如下内容：</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-pRnVR" id="tab-zs1mnea" checked><label data-title="ext4" for="tab-zs1mnea">ext4</label><input type="radio" name="group-pRnVR" id="tab-TRCzU3n"><label data-title="xfs" for="tab-TRCzU3n">xfs</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">/dev/mapper/rh-data</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">     /data</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">           ext4</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">     defaults</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        0</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">/dev/mapper/rh-data</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">     /data</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">           xfs</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      defaults</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        0</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div></div></div><h4 id="拓展-lvm-磁盘" tabindex="-1">拓展 LVM 磁盘 <a class="header-anchor" href="#拓展-lvm-磁盘" aria-label="Permalink to &quot;拓展 LVM 磁盘&quot;">​</a></h4><p>对于 LVM 磁盘来说，在磁盘空间不足的情况下拓展磁盘空间是很容易的，基本流程与新建 LVM 磁盘基本一致，不同之处在于添加到已经存在的 VG 中去，并在此之后的操作为重新索引文件系统而不是创建文件系统。</p><p>这里依然以 <code>sdb</code> 磁盘为例：</p><div class="timeline-dot"><span class="timeline-dot-title"></span><p>创建 PV</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">pvcreate</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/sdb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>使用如下命令查看当前存在的 VG：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vgdisplay</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>将新的 PV 添加到已经存在的 VG 中，这里我们假设 VG 为 rh-root：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vgextend</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rh-root</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/sdb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>拓展 LV</p><p>拓展 LV 的命令如下所示：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lvextend</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -l</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> +100%FREE</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/old-vg-name</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里拓展 VG rh-root 的具体命令如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lvextend</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -l</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> +100%FREE</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/rh-root</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>重新索引文件系统：</p><p>LV 拓展完成之后，还需要重新索引其文件系统，不然无法正常使用，对于不同的文件系统，分别使用如下的命令进行初始化：</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-FhTYG" id="tab-KbN0Yua" checked><label data-title="ext4 文件系统" for="tab-KbN0Yua">ext4 文件系统</label><input type="radio" name="group-FhTYG" id="tab-vch2EWI"><label data-title="xfs 文件系统" for="tab-vch2EWI">xfs 文件系统</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">resize2fs</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/centos-root</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">xfs_growfs</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /dev/mapper/centos-root</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div></div></div><h2 id="安全加固" tabindex="-1">安全加固 <a class="header-anchor" href="#安全加固" aria-label="Permalink to &quot;安全加固&quot;">​</a></h2><p>安全加固的主要目的是为了保证服务器的安全性，具体的操作内容有以下几点：</p><ul><li>升级低版本软件</li><li>修复系统漏洞</li><li>修改默认配置</li></ul><h3 id="ssl-版本升级" tabindex="-1">SSL 版本升级 <a class="header-anchor" href="#ssl-版本升级" aria-label="Permalink to &quot;SSL 版本升级&quot;">​</a></h3><p>为了修复服务器自带的 OpenSSL 1.0 版本的漏洞，将服务器的 OpenSSL 升级至 OpenSSL 1.1 版本（为了软件的兼容性考虑，暂不升级至 OpenSSL 3.0 版本）。</p><p>目前的 OpenSSL 1.1 版本已经结束新版本开发，其最新版本为 OpenSSL 1.1.1w，这里也将升级至该版本。</p><div class="timeline-dot"><span class="timeline-dot-title"></span><p>安装依赖</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> perl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> perl-devel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>下载软件包并解压编译安装</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">cd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">wget</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> https://github.com/openssl/openssl/releases/download/OpenSSL_1_1_1w/openssl-1.1.1w.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">tar</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -zxvf</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> openssl-1.1.1w.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">cd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src/openssl-1.1.1w</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">./config</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --prefix=/usr/local/openssl1.1</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> no-zlib</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">make</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> &amp;&amp;</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> make</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>编译安装完成后添加至环境变量及动态链接库</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/openssl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/openssl.bak</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/include/openssl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/include/openssl.bak</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -s</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssl1.1/bin/openssl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/openssl</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -s</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssl1.1/include/openssl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/include/openssl</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -s</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssl1.1/lib/libssl.so.1.1</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/lib64/libssl.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 不要多次执行，会添加多个</span></span>
<span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">echo</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &#39;/usr/local/openssl1.1/lib&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> &gt;&gt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/ld.so.conf</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ldconfig</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>验证安装</p><p>在如上命令成功执行后，使用如下命令进行验证：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">openssl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><h3 id="ssh-版本升级" tabindex="-1">SSH 版本升级 <a class="header-anchor" href="#ssh-版本升级" aria-label="Permalink to &quot;SSH 版本升级&quot;">​</a></h3><h4 id="前置事项" tabindex="-1">前置事项 <a class="header-anchor" href="#前置事项" aria-label="Permalink to &quot;前置事项&quot;">​</a></h4><div class="important custom-block github-alert"><p class="custom-block-title">特别注意：</p><p></p><p>在升级 SSH 过程中，请首先打开 Telnet 端口，以防止因为网络抖动造成的掉线问题导致无法连接至服务器。</p></div><p>开启 Telnet 的命令如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> xinetd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> telnet-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> enable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> xinetd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --now</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> enable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> telnet.socket</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --now</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,31)),i("p",null,[s[43]||(s[43]=a("查看本机的 23 端口是否开通，请先使用其他服务器进行连接验证，再进行 SSH 的升级操作，尤其是")),n(d,{class:"marker-evy"},{default:k(()=>s[42]||(s[42]=[a("防火墙的配置部分")])),_:1}),s[44]||(s[44]=a("一定要配置正确。"))]),s[72]||(s[72]=e(`<div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 本机</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">netstat</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -nltp</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 23</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> stop</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> firewalld</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> firewalld</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --now</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 其他机器</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">telnet</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> \${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">server-ip</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 23</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="升级操作" tabindex="-1">升级操作 <a class="header-anchor" href="#升级操作" aria-label="Permalink to &quot;升级操作&quot;">​</a></h4><p>升级 SSH 之前首先需要安装所需依赖：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> gcc</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> gcc-c++</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> glibc</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> make</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> autoconf</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> pcre-devel</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> pam-devel</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> zlib</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> zlib-devel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>依赖安装完成后，依次执行如下步骤，用于升级 OpenSSH：</p><div class="timeline-dot"><span class="timeline-dot-title"></span><p>下载源代码</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">cd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">wget</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.9p1.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">tar</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -zxvf</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> openssh-9.9p1.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>备份原配置文件</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/ssh</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/ssh.bak_</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">date</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;+%Y%m%d&quot;</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/pam.d/sshd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/pam.d/sshd.bak_</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">date</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;+%Y%m%d&quot;</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>编译安装</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">cd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src/openssh-9.9p1</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">./configure</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --prefix=/usr/local/openssh9.9</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --sysconfdir=/etc/ssh</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --with-openssl-includes=/usr/local/include</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --with-ssl-dir=/usr/local/openssl1.1</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --with-zlib</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --with-md5-passwords</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --with-pam</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">make</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> &amp;&amp;</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> make</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block github-alert"><p class="custom-block-title">备注：</p><p></p><p>再升级完 OpenSSL 之后再升级 OpenSSH 的情况下，再编译 OpenSSH 时可能出现下诉的报错：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">Configure:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> error:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Your</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> OpenSSL</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> headers</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> do</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> not</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> match</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> your</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        library.</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Check</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> config.log</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> for</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> details.</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        If</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> you</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> are</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> sure</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> your</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> installation</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> is</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> consistent,</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> you</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> can</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disabled</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> the</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> check</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        by</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> running</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;./configure --without-openssl-header-check&quot;.</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        Also</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> see</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> contrib/findssl.sh</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> for</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> help</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> identifying</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> header/library</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> mismatches.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>此时有两种方式解决：</p><ol><li>替换旧的 OpenSSL header 为新版 OpenSSL header</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -sf</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssl1.1/lib64/libssl.so.1.1</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      /usr/lib64/libssl.so.1.1</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -sf</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssl1.1/lib64/libcrypto.so.1.1</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   /usr/lib64/libcrypto.so.1.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>在编译 OpenSSH 的编译命令中添加 <code>--without-openssl-header-check</code> 参数</li></ol></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>修改配置文件</p><p>编译安装完成之后，需要修改配置文件，用以修复漏洞已经进行安全加固：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">cat</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> &gt;&gt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">/etc/ssh/sshd_config</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> &lt;&lt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">UseDNS no</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">PermitRootLogin yes</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">PubkeyAuthentication yes</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">PasswordAuthentication yes</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">X11Forwarding yes</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">X11UseLocalhost no</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">XAuthLocation /usr/bin/xauth</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521</span></span>
<span class="line"><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">EOF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>替换二进制文件</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/ssh</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/ssh.bak_</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">date</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;+%Y%m%d&quot;</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/sbin/sshd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/sbin/sshd.bak_</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">date</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;+%Y%m%d&quot;</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/ssh-keygen</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/ssh-keygen.bak_</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">date</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;+%Y%m%d&quot;</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -s</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssh9.9/bin/ssh</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/ssh</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -s</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssh9.9/bin/ssh-keygen</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/bin/ssh-keygen</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"> </span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ln</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -s</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/openssh9.9/sbin/sshd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/sbin/sshd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>使用 Service 管理 SSH 进程</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">rm</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">  -f</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/lib/systemd/system/sshd.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">cp</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -a</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src/openssh-9.9p1/contrib/redhat/sshd.init</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/init.d/sshd</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">cp</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -a</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src/openssh-9.9p1/contrib/redhat/sshd.pam</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/pam.d/sshd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">chmod</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> +x</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/init.d/sshd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> daemon-reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">/etc/init.d/sshd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="important custom-block github-alert"><p class="custom-block-title">重点：</p><p></p><p>必须设置 SSH 服务的开机自启。</p></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">chkconfig</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --add</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> sshd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">chkconfig</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> sshd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> on</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>验证安装</p><p>升级完成之后需要验证安装其版本以及可用性：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 查看版本</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ssh</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -V</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 使用其他服务器进行 SSH 连接验证</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>收尾工作</p><p>验证成功后，关闭 Telnet 连接，用于确保服务器的安全。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> stop</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> xinetd.service</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> xinetd.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> stop</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> telnet.socket</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> telnet.socket</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><h3 id="ssh-安全加固" tabindex="-1">SSH 安全加固 <a class="header-anchor" href="#ssh-安全加固" aria-label="Permalink to &quot;SSH 安全加固&quot;">​</a></h3><h4 id="修改连接协议" tabindex="-1">修改连接协议 <a class="header-anchor" href="#修改连接协议" aria-label="Permalink to &quot;修改连接协议&quot;">​</a></h4><p>SSHv1 协议是对 SSH 协议的不安全实现，为了系统的安全，需要修改为仅接受 SSHv2 连接。</p><div class="tip custom-block github-alert"><p class="custom-block-title">备注：</p><p>RedHat 和 CentOS 在 7.4 版本之后默认使用了 SSHv2，但是明确指定仍然是比较好的。</p></div><p>修改 <code>/etc/ssh/sshd_config</code> 文件，修改如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">Protocol 2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="修改默认端口" tabindex="-1">修改默认端口 <a class="header-anchor" href="#修改默认端口" aria-label="Permalink to &quot;修改默认端口&quot;">​</a></h4><p>SSH 服务的默认端口为 22 端口，需要修改为非常用端口号，修改 <code>/etc/ssh/sshd_config</code> 文件，修改如下内容即可：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">Port 22</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">Port 22022</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="显示最后一次登录" tabindex="-1">显示最后一次登录 <a class="header-anchor" href="#显示最后一次登录" aria-label="Permalink to &quot;显示最后一次登录&quot;">​</a></h4><p>这个是默认启用的，可以通过查看如下配置进行验证是否开启：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">PrintLastLog</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> yes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="结束空闲会话" tabindex="-1">结束空闲会话 <a class="header-anchor" href="#结束空闲会话" aria-label="Permalink to &quot;结束空闲会话&quot;">​</a></h4><p>当用户一段时间不进行操作后，应该主动结束空闲会话，用以防止其他用户在无人看管的情况下执行非法的指令，修改 <code>/etc/ssh/sshd_config</code> 文件的如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">// 单位为 s</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">ClientAliveInterval 900</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">ClientAliveCountMax 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="禁用空密码" tabindex="-1">禁用空密码 <a class="header-anchor" href="#禁用空密码" aria-label="Permalink to &quot;禁用空密码&quot;">​</a></h4><p>确保每一个用户连接服务器都需要密码验证，修改 <code>/etc/ssh/sshd_config</code> 文件的如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">PermitEmptyPasswords no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="禁止-root-登录" tabindex="-1">禁止 Root 登录 <a class="header-anchor" href="#禁止-root-登录" aria-label="Permalink to &quot;禁止 Root 登录&quot;">​</a></h4><p>出于安全性的进一步考虑，还需要配置禁止 root 用户的远程登录，修改 <code>/etc/ssh/sshd_config</code> 文件，修改如下内容即可：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> PermitRootLogin yes</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">PermitRootLogin no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以上内容修改完成后，重启 SSH 服务生效：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> sshd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="禁止切换至-root" tabindex="-1">禁止切换至 Root <a class="header-anchor" href="#禁止切换至-root" aria-label="Permalink to &quot;禁止切换至 Root&quot;">​</a></h4><p>如果需要禁止普通用户使用 <code>su -</code> 命令来切换至 root 用户，还需要配置如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/pam.d/su</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>修改如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">auth          required        pam_wheel.so use_uid</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">// 注释该内容即可</span></span>
<span class="line diff add"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> auth          required        pam_wheel.so use_uid</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个配置不需要重启生效，同理，可以进行反向运用处理无法切换至 root 用户的问题。</p><h4 id="配置-fail2ban" tabindex="-1">配置 Fail2Ban <a class="header-anchor" href="#配置-fail2ban" aria-label="Permalink to &quot;配置 Fail2Ban&quot;">​</a></h4><h3 id="防火墙配置" tabindex="-1">防火墙配置 <a class="header-anchor" href="#防火墙配置" aria-label="Permalink to &quot;防火墙配置&quot;">​</a></h3><h4 id="宽松设置" tabindex="-1">宽松设置 <a class="header-anchor" href="#宽松设置" aria-label="Permalink to &quot;宽松设置&quot;">​</a></h4><p>对于同一个域内的服务器来说，由于外部的 WAF 设备或堡垒机对于登录来源进行了严格的限制和校验，所以域内的服务器上的防火墙为了业务的性能和相互直接之间通信的简便性考量可以进行关闭处理，使用以下命令将防火墙的关闭：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 关闭防火墙</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> stop</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 关闭开机自启动</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> disable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> firewalld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="严格设置" tabindex="-1">严格设置 <a class="header-anchor" href="#严格设置" aria-label="Permalink to &quot;严格设置&quot;">​</a></h4><p>处于业务的安全性考虑，可以针对特定服务的端口对特定 IP 进行防火墙开放处理，对于防火墙的域，首先需要查看当前网卡所在的域，然后进行配置，对于不同的域，防火墙的默认策略也是不一样的，具体介绍如下：</p><h5 id="域介绍" tabindex="-1">域介绍 <a class="header-anchor" href="#域介绍" aria-label="Permalink to &quot;域介绍&quot;">​</a></h5><ul><li>trusted：接受所有的连接。</li><li>home、work、internal：接受大部分连接</li><li>public：只接受常见和最安全的连接</li><li>dmz：表示隔离区，多用于可公开访问，位于机构的外部网络，对内网访问受限的计算机</li><li>external：用于外部网络，会开启伪装（你的私网地址会被映射到一个外网 IP 地址并被隐藏）</li><li>block：仅接受在本系统中初始化的网络连接</li><li>drop：接受的所有网络包都被丢弃</li></ul><h5 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h5><p>系统默认的规则目录位于 <code>/usr/lib/firewalld/zones</code>，可以通过此目录查看每个域的默认策略，但是不建议直接修改该文件，建议修改自定义的规则目录 <code>/etc/firewalld/zones</code>，当需要添加和删除规则时，系统会自动将修改的配置保存至此目录，优先级高于默认规则。</p><h5 id="规则配置" tabindex="-1">规则配置 <a class="header-anchor" href="#规则配置" aria-label="Permalink to &quot;规则配置&quot;">​</a></h5><p>修改防护墙配置之前首先需要明确当前网卡的所在域，使用如下命令进行查看：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --get-active-zones</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行的结果如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">public</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  interfaces:</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> ens192</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以查看到当前系统网卡 <code>ens192</code> 的所在域为 <code>public</code>。如果想修改该网卡的所在域，可以执行如下命令进行修改：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --change-interface=ens192</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=dmz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,60)),i("p",null,[s[46]||(s[46]=a("在默认情况下，网卡所在域为 ")),s[47]||(s[47]=i("code",null,"public",-1)),s[48]||(s[48]=a("，对于该策略的更改，可以修改 ")),s[49]||(s[49]=i("code",null,"/etc/firewalld/zones/public.xml",-1)),s[50]||(s[50]=a(" 文件，也可以执行如下的命令进行常用的操作，")),n(d,{class:"marker-evy"},{default:k(()=>s[45]||(s[45]=[a("所有的操作完成后，需要重载 firewalld 使新规则生效，")])),_:1}),s[51]||(s[51]=a("对于其他域的修改，只需要将 ")),s[52]||(s[52]=i("code",null,"public",-1)),s[53]||(s[53]=a(" 替换为所需要的名称即可。"))]),s[73]||(s[73]=e(`<div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 运行所有网络使用 TCP 协议访问 8080 端口</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=public</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --add-port=8080/tcp</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 删除该规则</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=public</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --remove-port=8080/tcp</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 指定 IP 访问</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --permanent</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=ipv4 source address=172.16.1.1 port protocol=tcp port=8080 accept&#39;</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 删除该规则</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --permanent</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --remove-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=ipv4 source address=172.16.1.1 port protocol=tcp port=8080 accept&#39;</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 指定 IP 段访问</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --permanent</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=ipv4 source address=172.16.1.0/24 port protocol=tcp port=8080 accept&#39;</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 删除该规则</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --permanent</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --remove-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=ipv4 source address=172.16.1.0/24 port protocol=tcp port=8080 accept&#39;</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="关闭-selinux" tabindex="-1">关闭 SELinux <a class="header-anchor" href="#关闭-selinux" aria-label="Permalink to &quot;关闭 SELinux&quot;">​</a></h3><p>SELinux 是一个安全子系统，但是在很多情况下，为了避免以后某些软件由于 SELinux 问题从而无法配置，所以关闭 SELinux 是有必要的，修改如下配置内容即可：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/selinux/config</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>修改如下配置：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">SELINUX=enforcing</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">SELINUX=disabled</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改完成后，重启服务器使其生效，为了避免无法正常启动，在保存退出后需要在根目录下创建一个隐藏文件，再重启服务器：</p><div class="tip custom-block github-alert"><p class="custom-block-title">特别说明：</p><p>在根目录下创建 <code>.autorelabel</code> 文件后，系统会在下次启动时检测到该文件，并自动重新标记所有文件的安全上下文，确保它们与当前 SELinux 配置一致。这个过程完成后，文件会被自动删除。</p></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">touch</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /.autorelabel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>重启后使用如下命令进行查看状态：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">getenforce</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果暂时无法重启服务器，可以使用如下命令临时关闭，等待下次重启即可：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">setenforce</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="important custom-block github-alert"><p class="custom-block-title">特别注意：</p><p>这里的 0 代表的是 <code>permissive</code> 模式，并不是 <code>disabled</code> 模式，从 <code>enforcing</code> 和 <code>permissive</code> 模式转换为 <code>disabled</code> 模式需要重启服务器才能生效。</p></div><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><p>性能优化的主要目的是为了让服务器性能得到最大释放，保证服务不会因为服务器的配置存在性能瓶颈，具体的操作内容有以下几点：</p><ul><li>最大文件打开数修改</li><li>内核配置调整</li></ul><h2 id="其他部分" tabindex="-1">其他部分 <a class="header-anchor" href="#其他部分" aria-label="Permalink to &quot;其他部分&quot;">​</a></h2><div class="note custom-block github-alert"><p class="custom-block-title">备注：</p><p>该部分内容主要针对特定服务器的特定需求，对于不同业务而言，根据需要选择性的执行以下内容中的相关设置。</p></div><h3 id="安装显卡驱动" tabindex="-1">安装显卡驱动 <a class="header-anchor" href="#安装显卡驱动" aria-label="Permalink to &quot;安装显卡驱动&quot;">​</a></h3><div class="important custom-block github-alert"><p class="custom-block-title">说明：</p><p>这里安装的是闭源的 Nvidia 显卡驱动，用于机器学习和 AI 训练等。</p></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>查看当前的显卡驱动以及显卡的型号：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lspci</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -i</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nvidia</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div>`,22)),i("div",N,[s[57]||(s[57]=i("span",{class:"timeline-dot-title"},null,-1)),i("p",null,[s[55]||(s[55]=a("根据你的显卡型号去")),i("a",G,[n(r,{icon:"logos:nvidia"}),s[54]||(s[54]=a(" 官网"))]),s[56]||(s[56]=a("下载对应的驱动。"))]),s[58]||(s[58]=i("p",null,[a("下载完驱动后，上传至服务器的 "),i("code",null,"/usr/local/src"),a(" 目录下。")],-1))]),s[74]||(s[74]=e(`<div class="timeline-dot"><span class="timeline-dot-title"></span><p>Linux 系统一般默认安装的为开源的 <code>nouveau</code> 显卡驱动，会与我们将要安装的显卡驱动产生冲突。</p><p>使用如下命令查看当前是否加载了 <code>nouveau</code> 驱动：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lsmod</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nouveau</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果有输出说明 <code>nouveau</code> 驱动正在加载，需要禁用该驱动：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/lib/modprobe.d/dist-blacklist.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>写入如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">blacklist</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nouveau</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">options</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nouveau</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> modeset=</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>写入完成后备份当前的镜像，并创建新的镜像：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mv</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /boot/initramfs-</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">uname</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -r</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">.img</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /boot/initramfs-</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">uname</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -r</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">.img.bak</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">dracut</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /boot/initramfs-</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">$(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">uname</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -r</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">.img</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> $(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">uname</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -r</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 如下命令可能执行失败，影响不大</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">modprobe</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -r</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nouveau</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 执行完成后，重启服务器</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>重启完成后，执行最开始的命令查看显卡驱动是否被关闭：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">lsmod</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nouveau</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="timeline-dot"><span class="timeline-dot-title"></span><p>在安装驱动之前首先需要确保依赖安装完成：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> gcc</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> make</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> kernel-devel</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> libglvnd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> libglvnd-devel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行显卡驱动安装程序：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">cd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/local/src</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">chmod</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> a+x</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> NVIDIA-Linux-x86_64-570.144.run</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">./NVIDIA-Linux-x86_64-570.144.run</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-light-font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#9893A5;--shiki-light-font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic;"> 根据提示安装即可</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>安装完成后，执行如下命令验证：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">nvidia-smi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果有如下输出结果，即代表 Nvidia 显卡驱动安装成功。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">+---------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> NVIDIA-SMI</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 535.146.02</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">             Driver</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Version:</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 535.146.02</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   CUDA</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Version:</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 12.2</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">     |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">-----------------------------------------+----------------------+----------------------+</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> GPU</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  Name</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                 Persistence-M</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> Bus-Id</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">        Disp.A</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> Volatile</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Uncorr.</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> ECC</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> Fan</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  Temp</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   Perf</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">          Pwr:Usage/Cap</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">         Memory-Usage</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> GPU-Util</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  Compute</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> M.</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">                                         |</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">                      |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">               MIG</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> M.</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">=========================================+======================+======================</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">   0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  NVIDIA</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> TITAN</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Xp</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                Off</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 00000000:02:00.0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  On</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">                  N/A</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 23%</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   29C</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">    P5</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">              23W</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 250W</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    508MiB</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 12288MiB</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">      1%</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      Default</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">                                         |</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">                      |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">                  N/A</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">+-----------------------------------------+----------------------+----------------------+</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">                                                                                         </span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">+---------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> Processes:</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">                                                                            |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">  GPU</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   GI</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   CI</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">        PID</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   Type</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   Process</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> name</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                            GPU</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Memory</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        ID</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   ID</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                                                             Usage</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">      |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">=======================================================================================</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   N/A</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  N/A</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">      2787</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      G</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   /usr/libexec/Xorg</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                           124MiB</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   N/A</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  N/A</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">      2902</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      G</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   /usr/bin/gnome-shell</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                        133MiB</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   N/A</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  N/A</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">     28574</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      G</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   /usr/lib64/firefox/firefox</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                   11MiB</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">    0</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   N/A</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  N/A</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">     28943</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      G</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">   ...45,262144</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --variations-seed-version</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">      235MiB</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">+---------------------------------------------------------------------------------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div><h2 id="附录-a" tabindex="-1">附录 A <a class="header-anchor" href="#附录-a" aria-label="Permalink to &quot;附录 A&quot;">​</a></h2><h3 id="完整的-sysctl-conf-文件" tabindex="-1">完整的 sysctl.conf 文件 <a class="header-anchor" href="#完整的-sysctl-conf-文件" aria-label="Permalink to &quot;完整的 sysctl.conf 文件&quot;">​</a></h3>`,4)),n(o),n(c),s[75]||(s[75]=e('<hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://zhuanlan.zhihu.com/p/260938641" target="_blank" rel="noreferrer">如何在 Linux 中创建/配置 LVM（逻辑卷管理） | Linux 中国</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>',2))])}const X=b(g,[["render",R]]);export{j as __pageData,X as default};
