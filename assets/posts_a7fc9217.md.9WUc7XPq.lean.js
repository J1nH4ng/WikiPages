import{_ as r,C as l,c as k,o as d,j as i,aD as p,G as n,a}from"./chunks/framework.Cvnqwbck.js";const C=JSON.parse('{"title":"高危漏洞","description":"高危漏洞的解决文档","frontmatter":{"title":"高危漏洞","editLink":true,"description":"高危漏洞的解决文档","layout":"doc","head":[["meta",{"name":"keywords","content":"Linux, CVE"}]],"outline":"deep","prev":false,"next":{"text":"中危漏洞","link":"posts/dd1b7a70"}},"headers":[],"relativePath":"posts/a7fc9217.md","filePath":"docs/cve/0day.md","lastUpdated":1745647428000}'),o={name:"posts/a7fc9217.md"},c={id:"高危漏洞解决手册",tabindex:"-1"},u={id:"漏洞介绍",tabindex:"-1"},b={href:"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0554",target:"_blank",rel:"noreferrer"},g={id:"漏洞介绍-1",tabindex:"-1"},E={href:"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-20001",target:"_blank",rel:"noreferrer"};function y(m,s,F,A,D,f){const e=l("Icon"),t=l("NolebaseGitContributors"),h=l("NolebaseGitChangelog");return d(),k("div",null,[i("h1",c,[n(e,{icon:"mdi:shield-bug",style:{color:"#FF0000"}}),s[0]||(s[0]=a(" 高危漏洞解决手册 ")),s[1]||(s[1]=i("a",{class:"header-anchor",href:"#高危漏洞解决手册","aria-label":'Permalink to "<Icon icon="mdi:shield-bug" style="color: #FF0000" /> 高危漏洞解决手册"'},"​",-1))]),s[8]||(s[8]=i("h2",{id:"cve-1999-0554",tabindex:"-1"},[a("CVE-1999-0554 "),i("a",{class:"header-anchor",href:"#cve-1999-0554","aria-label":'Permalink to "CVE-1999-0554"'},"​")],-1)),i("h3",u,[s[2]||(s[2]=a("漏洞介绍 ")),i("a",b,[n(e,{icon:"solar:magnifer-bug-broken",style:{color:"#FF0000"}})]),s[3]||(s[3]=a()),s[4]||(s[4]=i("a",{class:"header-anchor",href:"#漏洞介绍","aria-label":'Permalink to "漏洞介绍 [<Icon icon="solar:magnifer-bug-broken" style="color: #FF0000" />](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0554)"'},"​",-1))]),s[9]||(s[9]=p(`<p>可以对目标主机进行 <code>showmount -e</code> 操作，此操作将泄露目标主机大量敏感信息，比如目录结构。更糟糕的是，如果访问控制不严的话，攻击者可能直接访问到目标主机上的数据。</p><h3 id="影响版本" tabindex="-1">影响版本 <a class="header-anchor" href="#影响版本" aria-label="Permalink to &quot;影响版本&quot;">​</a></h3><p>NFS 所有版本</p><h3 id="解决办法" tabindex="-1">解决办法 <a class="header-anchor" href="#解决办法" aria-label="Permalink to &quot;解决办法&quot;">​</a></h3><ul><li>限制可以获取 NFS 输出列表的 IP 和用户</li><li>除非绝对必要，关闭 NFS 服务器、MOUNTD</li></ul><h3 id="具体操作" tabindex="-1">具体操作 <a class="header-anchor" href="#具体操作" aria-label="Permalink to &quot;具体操作&quot;">​</a></h3><p>很多推荐的解决办法是配置 <code>/etc/hosts.allow</code> 和 <code>/etc/hosts.deny</code> 两个文件，分别写入如下内容：</p><ul><li><p><code>/etc/hosts.allow</code> 文件：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> mountd:192.168.1.1,192.168.1.2</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> rpcbind:192.168.1.1,192.168.1.2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><code>/ect/hosts.deny</code> 文件：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> mountd:ALL</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> rpcbind:ALL</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul><div class="note custom-block github-alert"><p class="custom-block-title">备注：</p><p></p><p>将上述的 IP 替换为实际的 IP 地址</p></div><p>修改完成后，在 192.168.1.3 服务器上（即未在白名单上的服务器）进行测试：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">showmount</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -e</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> \${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NFS_SERVER_IP</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>会发现依旧可以查看到敏感信息，这是因为 <code>hosts.allow</code> 和 <code>hosts.deny</code> 属于 tcp_Wrappers 防火墙的配置文件，而使用 tcp_Wrappers 防火墙控制某一服务访问策略的前提是：</p><p>该服务支持 tcp_Wrappers 防火墙，即该服务应用了 libwrapped 库文件。</p><p>可以通过如下命令进行查看：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ldd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /usr/sbin/sshd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> libwrap.so.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>对于 CentOS 系统会有如下的内容输出：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">[</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">root@localhost </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">~</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">]</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"># cat /etc/os-release </span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NAME</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;CentOS Linux&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">VERSION</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;7 (Core)&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">ID</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;centos&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">ID_LIKE</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;rhel fedora&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">VERSION_ID</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;7&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">PRETTY_NAME</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;CentOS Linux 7 (Core)&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">ANSI_COLOR</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;0;31&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">CPE_NAME</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;cpe:/o:centos:centos:7&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">HOME_URL</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;https://www.centos.org/&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">BUG_REPORT_URL</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;https://bugs.centos.org/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">CENTOS_MANTISBT_PROJECT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;CentOS-7&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">CENTOS_MANTISBT_PROJECT_VERSION</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;7&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">REDHAT_SUPPORT_PRODUCT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;centos&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">REDHAT_SUPPORT_PRODUCT_VERSION</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;7&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">[</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">root@localhost </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">~</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">]</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"># ldd /usr/sbin/sshd </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> libwrap.so.0</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">        libwrap.so.0</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"> =</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">&gt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /lib64/libwrap.so.0</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"> (0x00007fcde5764000)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>而对于欧拉/麒麟的系统而言，是没有任何输出结果的：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">[</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">root@localhost </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">~</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">]</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"># cat /etc/os-release </span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NAME</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;openEuler&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">VERSION</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;22.03 (LTS-SP1)&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">ID</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;openEuler&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">VERSION_ID</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;22.03&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">PRETTY_NAME</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;openEuler 22.03 (LTS-SP1)&quot;</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">ANSI_COLOR</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&quot;0;31&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">[</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">root@localhost </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">~</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">]</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;"># ldd /usr/sbin/sshd </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">|</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> libwrap.so.0</span></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">[</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">root@localhost </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">~</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">]</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">#</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>而这说明了欧拉/麒麟系统不能使用 <code>hosts.allow</code> 和 <code>hosts.deny</code> 方式来控制访问。</p><p>所以需要通过防火墙来控制访问：</p><p>NFS 服务的端口是不固定的，所以需要通过如下的配置来进行固定：</p><ol><li><p>修改 <code>/etc/services</code> 文件，修改如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    20048/udp</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    20048/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    30003/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    30003/udp</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   875/udp</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   875/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   30001/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   30001/udp</span></span>
<span class="line"></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">lockd     30002/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">lockd     30002/udp</span></span>
<span class="line"></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">statd     30004/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">statd     30004/udp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li><li><p>修改完成后，重启服务生效</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时，使用 <code>rpcinfo -p</code> 命令查看，会发现部分端口仍然是随机端口，还需要修改如下的配置文件：</p></li><li><p>修改 <code>/etc/nfs.conf</code> 文件，添加如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">[lockd]</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">port=30002</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">udp-port=30002</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">[statd]</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">port=30004</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p>修改完成后，重启服务生效</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-idmap</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-lock</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-server</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>重启成功后，使用 <code>rpcinfo -p</code> 命令查看，会发现端口已经变成固定端口。</p></li></ol><p>固定完端口后，需要配置防火墙规则来进行访问控制：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=public</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;tcp&quot; port=&quot;111&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;tcp&quot; port=&quot;2049&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;tcp&quot; port=&quot;30001-30004&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=public</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;udp&quot; port=&quot;111&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;udp&quot; port=&quot;2049&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;udp&quot; port=&quot;30001-30004&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --permanen</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="note custom-block github-alert"><p class="custom-block-title">备注：</p><p></p><ol><li>这里的 <code>192.168.1.1</code> 是指 Web 服务器的 IP 地址，根据实际情况修改。</li><li>如果需要指定一个网段的 IP 地址，可以将 <code>192.168.1.1</code> 改成 CIDR 表示法，如 <code>192.168.1.0/24</code>。</li></ol></div><h2 id="cve-2002-20001" tabindex="-1">CVE-2002-20001 <a class="header-anchor" href="#cve-2002-20001" aria-label="Permalink to &quot;CVE-2002-20001&quot;">​</a></h2>`,27)),i("h3",g,[s[5]||(s[5]=a("漏洞介绍 ")),i("a",E,[n(e,{icon:"solar:magnifer-bug-broken",style:{color:"#FF0000"}})]),s[6]||(s[6]=a()),s[7]||(s[7]=i("a",{class:"header-anchor",href:"#漏洞介绍-1","aria-label":'Permalink to "漏洞介绍 [<Icon icon="solar:magnifer-bug-broken" style="color: #FF0000" />](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-20001)"'},"​",-1))]),s[10]||(s[10]=p(`<p>Diffie-Hellman Key Agreement Protocol是一种密钥协商协议。它最初在 Diffie 和 Hellman 关于公钥密码学的开创性论文中有所描述。</p><p>该密钥协商协议允许 Alice 和 Bob 交换公钥值，并根据这些值和他们自己对应的私钥的知识，安全地计算共享密钥K，从而实现进一步的安全通信。</p><p>仅知道交换的公钥值，窃听者无法计算共享密钥。Diffie-Hellman Key Agreement Protocol 存在安全漏洞，远程攻击者可以发送实际上不是公钥的任意数字，并触发服务器端DHE模幂计算。</p><h3 id="影响版本-1" tabindex="-1">影响版本 <a class="header-anchor" href="#影响版本-1" aria-label="Permalink to &quot;影响版本&quot;">​</a></h3><p>OpenSSH 所有版本</p><h3 id="解决办法-1" tabindex="-1">解决办法 <a class="header-anchor" href="#解决办法-1" aria-label="Permalink to &quot;解决办法&quot;">​</a></h3><ul><li>禁用 SSH 弱密钥交换算法</li></ul><h3 id="具体操作-1" tabindex="-1">具体操作 <a class="header-anchor" href="#具体操作-1" aria-label="Permalink to &quot;具体操作&quot;">​</a></h3><p>查看当前 SSH 客户端支持的算法：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ssh</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -Q</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> kex</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>结果如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group1-sha1</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group14-sha1</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group14-sha256</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group16-sha512</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group18-sha512</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group-exchange-sha1</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">diffie-hellman-group-exchange-sha256</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ecdh-sha2-nistp256</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ecdh-sha2-nistp384</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ecdh-sha2-nistp521</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">curve25519-sha256</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">curve25519-sha256@libssh.org</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">sntrup761x25519-sha512@openssh.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>OpenSSH 支持基本上很多的算法，其中包括 Diffie-Hellman Key Agreement Protocol，而服务端没有禁用该算法的话，攻击者可以利用该漏洞进行攻击。</p><p>查看当时 SSH 服务端允许的算法：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">sshd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -T</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> |</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> grep</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -w</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> kexalgorithms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>结果如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">kexalgorithms</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> sntrup761x25519-sha512@openssh.com,</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">curve25519-sha256, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">curve25519-sha256@libssh.org, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">ecdh-sha2-nistp256, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">ecdh-sha2-nistp384, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">ecdh-sha2-nistp521, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">diffie-hellman-group-exchange-sha256, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">diffie-hellman-group16-sha512, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">diffie-hellman-group18-sha512, </span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">\\</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">diffie-hellman-group14-sha256</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>为了便于阅读，这里进行了换行处理，可以查看到服务端没有禁用通过 Diffie-Hellman 算法来进行 SSH 连接。</p><p>执行以下内容，明文禁用该系列算法：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">echo</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;KexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521&quot;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> &gt;&gt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> sshd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>重启完成后，使用 Differie-Hellman 算法进行连接验证：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ssh</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -v</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -oKexAlgorithms=diffie-hellman-group-exchange-sha256</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> root@</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">&lt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">target-i</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">p</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>无法成功连接，则代表该系列算法被禁用，此时，不指定算法进行连接：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">ssh</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> root@</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">&lt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">target-i</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">p</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可以发现连接成功。</p>`,25)),n(t),n(h)])}const q=r(o,[["render",y]]);export{C as __pageData,q as default};
