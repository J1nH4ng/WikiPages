import{f as d,D as i,c as h,o,as as n,k as e,H as a,a as t}from"./chunks/framework.Dr7m8lqR.js";const k="/images/infrastructure/nfs.svg",A=JSON.parse('{"title":"NFS 存储仓库搭建","description":"NFS 存储仓库搭建文档","frontmatter":{"title":"NFS 存储仓库搭建","editLink":true,"description":"NFS 存储仓库搭建文档","layout":"doc","head":[["meta",{"name":"keywords","content":"Linux, NFS"}]],"outline":"deep","prev":{"text":"DNS 服务器搭建","link":"posts/6c8dde8f"},"next":{"text":"Docker 镜像代理搭建","link":"posts/02bb9bb8"}},"headers":[],"relativePath":"posts/d6bbd820.md","filePath":"docs/infrastructure/nfs.md","lastUpdated":1745480004000}'),c={name:"posts/d6bbd820.md"},b={href:"./a7fc9217.html#cve-1999-0554"};function u(y,s,g,m,E,f){const l=i("Icon"),p=i("NolebaseGitContributors"),r=i("NolebaseGitChangelog");return o(),h("div",null,[s[2]||(s[2]=n(`<h1 id="nfs-存储仓库搭建" tabindex="-1">NFS 存储仓库搭建 <a class="header-anchor" href="#nfs-存储仓库搭建" aria-label="Permalink to &quot;NFS 存储仓库搭建&quot;">​</a></h1><p>NFS 全称为 Network File System，即网络文件存储系统，它是一种分布式文件系统协议，允许网络中的计算机之间通过网络共享文件。NFS 服务器可以让多个客户端通过网络访问同一文件系统，使得文件共享更加方便。</p><p>NFS 依赖与 RPC 协议，因此需要安装如下软件：</p><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_0" checked="true" disabled="true"><label for="cbx_0"> nfs-utils</label></li><li class="task-list-item"><input type="checkbox" id="cbx_1" checked="true" disabled="true"><label for="cbx_1"> rpcbind</label></li></ul><h2 id="nfs-服务安装" tabindex="-1">NFS 服务安装 <a class="header-anchor" href="#nfs-服务安装" aria-label="Permalink to &quot;NFS 服务安装&quot;">​</a></h2><ol><li><p>安装软件包：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-utils</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>创建需要共享的目录并设置权限：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkdir</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -p</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data/share</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">chmod</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;"> 755</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -R</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data/share</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>启动 NFS 服务：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> enable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --now</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> enable</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --now</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h2 id="nfs-服务配置" tabindex="-1">NFS 服务配置 <a class="header-anchor" href="#nfs-服务配置" aria-label="Permalink to &quot;NFS 服务配置&quot;">​</a></h2><p>NFS 服务启动成功后，还需要进行配置修改，以便于应用服务器可以发现查找到该存储。</p><p>NFS 的配置文件为：<code>/etc/exports</code>，编辑该文件，添加如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">/data/share/</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 192.168.14.0/24</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">(</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">rw,no_root_squash,sync,no_subtree_check</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里的配置文件参数讲解如下：</p><div align="center"><img src="`+k+`" width="80%" height="80%" alt="nfs 配置介绍"></div><ol><li><p><strong>分享目录</strong>表示你要共享的目录</p></li><li><p><strong>IP 限制</strong>表示允许访问的 IP 地址，这里表示允许 192.168.14.0/24 网段的主机访问，如果要指定服务器访问，请写成具体的服务器 IP 地址，* 代表所有服务器都可以访问</p></li><li><p><strong>权限部分</strong>表示允许访问的权限，这里表示读写权限，<code>no_root_squash</code> 表示不允许 root 用户访问，<code>sync</code> 表示数据同步写入，<code>no_subtree_check</code> 表示不检查子目录。</p><details class="details custom-block"><summary>全部权限属性列表：</summary><table tabindex="0"><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;"><code>ro</code></td><td style="text-align:left;">只读访问</td></tr><tr><td style="text-align:left;"><code>rw</code></td><td style="text-align:left;">读写访问</td></tr><tr><td style="text-align:left;"><code>sync</code></td><td style="text-align:left;">所有数据在请求时写入共享</td></tr><tr><td style="text-align:left;"><code>async</code></td><td style="text-align:left;">nfs 在写入数据前可以响应请求</td></tr><tr><td style="text-align:left;"><code>secure</code></td><td style="text-align:left;">nfs 通过 1024 以下的安全 TCP/IP 端口发送</td></tr><tr><td style="text-align:left;"><code>insecure</code></td><td style="text-align:left;">nfs 通过 1024 以上的端口发送</td></tr><tr><td style="text-align:left;"><code>wdelay</code></td><td style="text-align:left;">如果多个用户要写入 nfs 目录，则归组写入（默认）</td></tr><tr><td style="text-align:left;"><code>no_wdelay</code></td><td style="text-align:left;">如果多个用户要写入 nfs 目录，则立即写入，当使用 async 时，无需此设置</td></tr><tr><td style="text-align:left;"><code>hide</code></td><td style="text-align:left;">在 nfs 共享目录中不共享其子目录</td></tr><tr><td style="text-align:left;"><code>no_hide</code></td><td style="text-align:left;">共享 nfs 目录的子目录</td></tr><tr><td style="text-align:left;"><code>subtree_check</code></td><td style="text-align:left;">如果共享 /usr/bin 之类的子目录时，强制 nfs 检查父目录的权限（默认）</td></tr><tr><td style="text-align:left;"><code>no_subtree_check</code></td><td style="text-align:left;">不检查父目录权限</td></tr><tr><td style="text-align:left;"><code>all_squash</code></td><td style="text-align:left;">共享文件的 UID 和 GID 映射匿名用户 anonymous，适合公用目录</td></tr><tr><td style="text-align:left;"><code>no_all_squash</code></td><td style="text-align:left;">保留共享文件的 UID 和 GID（默认）</td></tr><tr><td style="text-align:left;"><code>root_squash</code></td><td style="text-align:left;">oot 用户的所有请求映射成如 anonymous 用户一样的权限（默认）</td></tr><tr><td style="text-align:left;"><code>no_root_squash</code></td><td style="text-align:left;">root 用户具有根目录的完全管理访问权限</td></tr><tr><td style="text-align:left;"><code>anonuid=xxx</code></td><td style="text-align:left;">指定 nfs 服务器 /etc/passwd 文件中匿名用户的 UID</td></tr><tr><td style="text-align:left;"><code>anongid=xxx</code></td><td style="text-align:left;">指定 nfs 服务器 /etc/passwd 文件中匿名用户的 GID</td></tr></tbody></table></details></li></ol><p>配置完成后，执行如下命令生效：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">exportfs</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -ra</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>启动成功后，我们可以通过使用 <code>showmount</code> 命令来查看服务端（即 NFS 服务器本机）是否可以连接：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">showmount</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -e</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> localhost</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果一切正常，输出结果应该类似于如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">Export</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> list</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> for</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> localhost:</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">/data/share</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> 192.168.14.0/24</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="nfs-客户端配置" tabindex="-1">NFS 客户端配置 <a class="header-anchor" href="#nfs-客户端配置" aria-label="Permalink to &quot;NFS 客户端配置&quot;">​</a></h2><p>NFS 客户端即用户端只需要安装 <code>rpcbind</code> 服务即可：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">yum</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> install</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -y</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看远程 NFS 服务器是否共享：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">showmount</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -e</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> \${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NFS_SERVER_IP</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>建立需要挂载的目录并挂载到远程：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mkdir</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -p</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data/share</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">mount</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -t</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;"> \${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NFS_SERVER_IP</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">:/data/share</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data/share</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> -o</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nolock,nfsvers=3,vers=</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="note custom-block github-alert"><p class="custom-block-title">备注：</p><p></p><p>如果不加 <code>-onolock,nfsvers=3</code> 则在挂载目录下的文件属主和组都是 nobody，如果指定<code> nfsvers=3</code> 则显示 root。</p><p>取消挂载命令如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">umount</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /data/share</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><p>挂载完成后，使用 <code>df -h</code> 命令查看挂载情况：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">Filesystem</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">                    Size</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">  Used</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Avail</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Use%</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> Mounted</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> on</span></span>
<span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">...</span></span>
<span class="line"><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">\${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NFS_SERVER_IP</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">:/data/share  1.0T  1.2G  1.0T   1% /data/share</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>配置开机自动挂载：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B4637A;--shiki-light-font-style:italic;--shiki-dark:#EB6F92;--shiki-dark-font-style:italic;">echo</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> &quot;mount -t nfs </span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">\${</span><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">NFS_SERVER_IP</span><span style="--shiki-light:#797593;--shiki-dark:#908CAA;">}</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">:/data/share /data/share -o nolock,nfsvers=3,vers=3&quot;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> &gt;&gt;</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/rc.local</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="防火墙配置" tabindex="-1">防火墙配置 <a class="header-anchor" href="#防火墙配置" aria-label="Permalink to &quot;防火墙配置&quot;">​</a></h2><h3 id="固定-nfs-端口" tabindex="-1">固定 NFS 端口 <a class="header-anchor" href="#固定-nfs-端口" aria-label="Permalink to &quot;固定 NFS 端口&quot;">​</a></h3><p>NFS 的防火墙配置需要配置较多端口，除了固定的端口 <code>2049</code>、<code>111</code> 外，其他的服务端口是不固定的，对于防火墙配置来说是很困难的，所以我们需要修改 NFS 配置文件，去指定端口。</p><p>对于不同的操作系统有不同的配置区别：</p><h4 id="麒麟-欧拉服务器配置" tabindex="-1">麒麟/欧拉服务器配置 <a class="header-anchor" href="#麒麟-欧拉服务器配置" aria-label="Permalink to &quot;麒麟/欧拉服务器配置&quot;">​</a></h4><p>由于国产服务器的适配的不同，需要进行的操作步骤也是不同的：<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><ol><li><p>修改 <code>/etc/services</code> 文件，修改如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    20048/udp</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    20048/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    30003/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">mountd    30003/udp</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   875/udp</span></span>
<span class="line diff remove"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   875/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   30001/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">rquotad   30001/udp</span></span>
<span class="line"></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">lockd     30002/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">lockd     30002/udp</span></span>
<span class="line"></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">statd     30004/tcp</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">statd     30004/udp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li><li><p>修改完成后，重启服务生效</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时，使用 <code>rpcinfo -p</code> 命令查看，会发现部分端口仍然是随机端口，还需要修改如下的配置文件：</p></li><li><p>修改 <code>/etc/nfs.conf</code> 文件，添加如下内容：</p><div class="language-diff vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon has-diff vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">[lockd]</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">port=30002</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">udp-port=30002</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">[statd]</span></span>
<span class="line diff add"><span style="--shiki-light:#575279;--shiki-dark:#E0DEF4;">port=30004</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p>修改完成后，重启服务生效</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-idmap</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-lock</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-server</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>重启成功后，使用 <code>rpcinfo -p</code> 命令查看，会发现端口已经变成固定端口。</p></li></ol><h4 id="centos-7-服务器配置" tabindex="-1">CentOS 7 服务器配置 <a class="header-anchor" href="#centos-7-服务器配置" aria-label="Permalink to &quot;CentOS 7 服务器配置&quot;">​</a></h4><p>对于搜索出来的很多配置方式如下，这仅针对于 CentOS 7 服务器，其它版本的服务器并不会生效：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/sysconfig/nfs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">RQUOTAD_PORT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">30001</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">LOCKD_TCPPORT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">30002</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">LOCKD_UDPPORT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">30002</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">MOUNTD_PORT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">30003</span></span>
<span class="line"><span style="--shiki-light:#575279;--shiki-light-font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic;">STATD_PORT</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">30004</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>配置完成后，重启 NFS 和 rpcbind 服务：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置完 NFS 文件之后，还需要修改内核配置文件：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">vim</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> /etc/modprobe.d/lockd.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>写入如下内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">options</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lockd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nlm_tcpport=</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">30002</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">options</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> lockd</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nlm_udpport=</span><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">30002</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重启 NFS 服务生效：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-conf</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-idmap</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-lock</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> nfs-server</span></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">systemctl</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> restart</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;"> rpcbind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>重启成功后，使用 <code>rpcinfo -p</code> 命令查看，会发现端口已经变成固定端口。</p><h3 id="防火墙配置-1" tabindex="-1">防火墙配置 <a class="header-anchor" href="#防火墙配置-1" aria-label="Permalink to &quot;防火墙配置&quot;">​</a></h3><p>配置完 NFS 为固定端口服务后，可以在防火墙中放行相对应的端口了：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes rose-pine-dawn rose-pine-moon vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=public</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;tcp&quot; port=&quot;111&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;tcp&quot; port=&quot;2049&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;tcp&quot; port=&quot;30001-30004&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --zone=public</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;udp&quot; port=&quot;111&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;udp&quot; port=&quot;2049&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --add-rich-rule=</span><span style="--shiki-light:#EA9D34;--shiki-dark:#F6C177;">&#39;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.1&quot; port protocol=&quot;udp&quot; port=&quot;30001-30004&quot; accept&#39;</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;">    --permanen</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D7827E;--shiki-dark:#EA9A97;">firewall-cmd</span><span style="--shiki-light:#286983;--shiki-dark:#3E8FB0;"> --reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="note custom-block github-alert"><p class="custom-block-title">备注：</p><p></p><ol><li>这里的 <code>192.168.1.1</code> 是指 Web 服务器的 IP 地址，根据实际情况修改。</li><li>如果需要指定一个网段的 IP 地址，可以将 <code>192.168.1.1</code> 改成 CIDR 表示法，如 <code>192.168.1.0/24</code>。</li></ol></div>`,56)),e("p",null,[s[1]||(s[1]=t("对于内网而言，很多时候是将防火墙关闭的，此时这部分的配置是可以忽略的，但是出于安全的考虑，应当开启防火墙，并配置允许的 IP 地址，用于")),e("a",b,[a(l,{icon:"wpf:security-checked",style:{color:"#208320"}}),s[0]||(s[0]=t("修复 CVE-1999-0554 漏洞"))])]),a(p),a(r),s[3]||(s[3]=n('<hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://blog.csdn.net/qq_34777982/article/details/126756015" target="_blank" rel="noreferrer">openEuler\\银河麒麟\\UOS等国产操作系统固定NFS端口和安全加固——筑梦之路</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>',2))])}const F=d(c,[["render",u]]);export{A as __pageData,F as default};
